<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>YodaCast</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script src="./model.js"></script>
</head>

<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-12 d-flex justify-content-center">
                <div class="card mx-2" onclick="selecionarPersonagem('yoda', './imagens/master_yoda_pixelart.png')">
                    <img src="./imagens/master_yoda_pixelart.png" width="115px">
                </div>
                <div class="card mx-2"
                    onclick="selecionarPersonagem('coringa', 'https://cdn2.steamgriddb.com/icon_thumb/f1eba978f8a36c92875063b46fd7e3a1.png')">
                    <img src="https://cdn2.steamgriddb.com/icon_thumb/f1eba978f8a36c92875063b46fd7e3a1.png"
                        width="115px">
                </div>
                <div class="card mx-2"
                    onclick="selecionarPersonagem('gollum', 'https://pixeljoint.com/files/icons/preview153.gif')">
                    <img src="https://pixeljoint.com/files/icons/preview153.gif" width="115px">
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row d-flex justify-content-center mb-3">
            <div class="col-8">
                <div class="card shadow d-flex align-items-center p-3 m-2" id="card-top">
                    <div class="row align-items-center">
                        <div class="col-md-12 col-lg-4 d-flex justify-content-center">
                            <img src="/mestre_yoda/imagens/master_yoda.png" class="img-fluid w-50">
                        </div>
                        <div class="col-md-12 col-lg-8 d-flex align-items-center">
                            <div class="mx-3 my-3">
                                <label for="pergunta" class="text">Sua pergunta digite</label>
                                <input type="text" name="pergunta" class="p-2" id="pergunta" placeholder=". . .">
                                <button type="submit" class="btn btn-success my-3" onclick="perguntar()">Enviar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row d-flex justify-content-center">
            <div class="col-8">
                <div class="card shadow">
                    <div class="card-resposta card-body">
                        <div class="row" id="chat">
                            <!-- <div class="col-12 d-flex justify-content-end">
                                <div class="card m-1 p-2 bg-secondary text-light">Meu texto de pergunta</div>
                            </div>
                            <div class="col-12 d-flex justify-content-start">
                                <div class="card m-1 p-2 bg-secondary text-light">Resposta do Yoda</div>
                            </div> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let personagem
        function selecionarPersonagem(nome, foto) {
            personagem = new Personagem(nome, foto);
        }

        let chat = document.getElementById('chat');

        function perguntar() {
            let pergunta = document.getElementById('pergunta').value;

            const KEY = `CHAVE-AQUI`;

            const URL = `https://api.openai.com/v1/chat/completions`;

            fetch(URL, {
                method: 'POST', //post, get, delete, put
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [
                        { role: 'system', content: `Me responda como se vocÃª fosse o ${personagem.nome}, de forma curta e clara` },
                        { role: 'user', content: pergunta },
                    ],
                    max_tokens: 50
                })
            })
                .then(resp => resp.json())
                .then(resp => {
                    console.log(resp);
                    let col_perg = document.createElement('div');
                    col_perg.classList.add('col-12', 'd-flex', 'justify-content-end');

                    let col_resp = document.createElement('div');
                    col_resp.classList.add('col-12', 'd-flex', 'justify-content-start');

                    let card_perg = document.createElement('div');
                    card_perg.classList.add('minhaResposta', 'card', 'm-1', 'p-2', 'shadow');
                    card_perg.innerText = pergunta;

                    let card_resp = document.createElement('div');
                    card_resp.classList.add('respostaYoda', 'card', 'm-1', 'p-2', 'shadow', 'text-light')
                    card_resp.innerText = personagem.nome + ' diz: ' + resp.choices[0].message.content;

                    let foto = document.createElement('img');
                    foto.setAttribute('src', personagem.foto);
                    foto.setAttribute('width', '70px');

                    col_resp.appendChild(foto);

                    chat.appendChild(col_perg);
                    chat.appendChild(col_resp);

                    col_perg.appendChild(card_perg);
                    col_resp.appendChild(card_resp);
                })
                .catch(erro => {
                    console.log(erro);
                })
                .finally(() => {
                    console.log('Finalizado');
                })
        }



    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
</body>

</html>